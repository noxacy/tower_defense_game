name: Deploy Pygame to GitHub Pages

on:
  push:
    branches: [ main ]  # Runs every time you push to main

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
          - uses: actions/checkout@v3

          # 1. Set up Python environment
          - name: Set up Python
            uses: actions/setup-python@v4
            with:
              python-version: '3.11'

          # 2. Install pygbag and dependencies
          - name: Install dependencies
            run: |
              python -m pip install --upgrade pip
              python -m pip install pygbag black

          # 3. Build the game
          - name: Build Tower Defense
            run: |
              python -m pygbag --build td/
              
          # 4. Assemble the Arcade (Menu + Game)
          - name: Prepare Deployment Folder
            run: |
              mkdir -p deploy
              cp index.html deploy/
              mkdir -p deploy/td
              cp -r td/build/web/* deploy/td/

          # 5. Deploy
          - name: Deploy to GitHub Pages
            uses: JamesIves/github-pages-deploy-action@v4
            with:
              folder: deploy
              branch: gh-pages
